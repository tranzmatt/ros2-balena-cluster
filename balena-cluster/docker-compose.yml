version: "2.1"

services:
  ros-node:
    build:
      context: .
      dockerfile: Dockerfile.ros2
    privileged: true
    network_mode: host
    restart: always
    environment:
      # ROS2 Discovery
      - ROS_DISCOVERY_SERVER=${ROS_DISCOVERY_SERVER}
      - ROS_DOMAIN_ID=${ROS_DOMAIN_ID}
      - RMW_IMPLEMENTATION=${RMW_IMPLEMENTATION}
      - ROS_LOCALHOST_ONLY=${ROS_LOCALHOST_ONLY}
      - ROS_SUPER_CLIENT=${ROS_SUPER_CLIENT}
      # Node behavior
      - NODE_ROLE=${NODE_ROLE}
      # Camera settings (defaults handled in Python)
      - CAMERA_WIDTH=${CAMERA_WIDTH}
      - CAMERA_HEIGHT=${CAMERA_HEIGHT}
      - CAMERA_FPS=${CAMERA_FPS}
      - CAMERA_JPEG_QUALITY=${CAMERA_JPEG_QUALITY}
      # Image viewer settings
      - SAVE_IMAGES=${SAVE_IMAGES}
      - SAVE_PATH=${SAVE_PATH}
      - SAVE_INTERVAL=${SAVE_INTERVAL}
    volumes:
      - ros2-logs:/root/.ros/log
      - shared-data:/shared
    labels:
      io.balena.features.dbus: "1"
      io.balena.features.kernel-modules: "1"

volumes:
  ros2-logs:
  shared-data:
