version: "2.1"

services:
  ros-node:
    build:
      context: .
      dockerfile: Dockerfile.ros2
    privileged: true
    network_mode: host
    restart: always
    environment:
      - ROS_DISCOVERY_SERVER=${ROS_DISCOVERY_SERVER}
      - ROS_DOMAIN_ID=${ROS_DOMAIN_ID:-0}
      - RMW_IMPLEMENTATION=${RMW_IMPLEMENTATION:-rmw_fastrtps_cpp}
      - ROS_LOCALHOST_ONLY=${ROS_LOCALHOST_ONLY:-0}
      - ROS_SUPER_CLIENT=${ROS_SUPER_CLIENT:-false}
      - NODE_NAME=${BALENA_DEVICE_NAME_AT_INIT:-ros2_node}
    volumes:
      - ros2-logs:/root/.ros/log
      - shared-data:/shared
    labels:
      io.balena.features.dbus: "1"
      io.balena.features.kernel-modules: "1"
    # No command - entrypoint defaults to sleep infinity

volumes:
  ros2-logs:
  shared-data:
