# File: docker-compose.yml

services:
  # The "Brain" of the network
  discovery-server:
    build: .
    container_name: ros-discovery-server
    # Use host networking so we don't have to map ports manually 
    # and so the server sees the real network interface.
    network_mode: host
    restart: unless-stopped
    # Use the actual binary - the fastdds wrapper is broken
    command: /opt/ros/jazzy/bin/fast-discovery-server -i 0 -p 11811

  # Optional: A local monitor to verify the server sees traffic
  # specific to this machine
  monitor:
    build: .
    container_name: ros-monitor
    network_mode: host
    # This environment variable tells this node to talk to the server 
    # defined above (localhost relative to this machine)
    environment:
      - ROS_DISCOVERY_SERVER=127.0.0.1:11811
      - FASTRTPS_DEFAULT_PROFILES_FILE=/opt/ros/fastdds_client.xml
      - ROS_AUTOMATIC_DISCOVERY_RANGE=${ROS_AUTOMATIC_DISCOVERY_RANGE}
    command: sleep infinity
